<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pythonå­¦ä¹  day3-æ•°æ®å¤„ç† | Ran Xue</title>
<link rel="shortcut icon" href="https://RanX79.github.io//favicon.ico?v=1710485274652">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://RanX79.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Pythonå­¦ä¹  day3-æ•°æ®å¤„ç† | Ran Xue - Atom Feed" href="https://RanX79.github.io//atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="python åˆ©ç”¨Xarrayå¤„ç†ncæ•°æ®
æ³¨æ„æ•°æ®çš„æ ¼å¼(ç»çº¬åº¦èŒƒå›´ã€åˆ†è¾¨ç‡ã€æ—¶é—´æ ¼å¼ã€å˜é‡ç­‰åŸºæœ¬ä¿¡æ¯ï¼‰
æŸ¥çœ‹æ•°æ®ä¿¡æ¯
import xarray as xr
f = xr.open_dataset('D:\download\hgt.mo..." />
    <meta name="keywords" content="python" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://RanX79.github.io/">
  <img class="avatar" src="https://RanX79.github.io//images/avatar.png?v=1710485274652" alt="">
  </a>
  <h1 class="site-title">
    Ran Xue
  </h1>
  <p class="site-description">
    æ˜¯å†‰å†‰å‡èµ·çš„å†‰
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Pythonå­¦ä¹  day3-æ•°æ®å¤„ç†
            </h2>
            <div class="post-info">
              <span>
                2022-08-31
              </span>
              <span>
                8 min read
              </span>
              
                <a href="https://RanX79.github.io/tag/ZhhwPASHX/" class="post-tag">
                  # python
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>python åˆ©ç”¨Xarrayå¤„ç†ncæ•°æ®</p>
<p><font color=red>æ³¨æ„æ•°æ®çš„æ ¼å¼(ç»çº¬åº¦èŒƒå›´ã€åˆ†è¾¨ç‡ã€æ—¶é—´æ ¼å¼ã€å˜é‡ç­‰åŸºæœ¬ä¿¡æ¯ï¼‰</font><br>
<font color=Blue><center><strong>æŸ¥çœ‹æ•°æ®ä¿¡æ¯</strong></font></center></p>
<pre><code>import xarray as xr
f = xr.open_dataset('D:\download\hgt.mon.mean.nc')
print(f)
#æŸ¥çœ‹ç»´åº¦ä¿¡æ¯
lat=f.lat
lon=f.lon
time=f.time
print(lat)
</code></pre>
<p>æ—¶é—´æ ¼å¼ä¸ºï¼š***datetime64[ns]***æ—¶æœ€æ–¹ä¾¿ï¼Œç›´æ¥ç´¢å¼•å³å¯ã€‚<br>
egï¼š<br>
* time     (time) datetime64[ns] 1948-01-01 1948-02-01 ... 2019-01-01<br>
éœ€è¦é€‰å–2005å¹´åˆ°2010å¹´å†¬å­£çš„æ•°æ®</p>
<pre><code>#é€‰å–2005å¹´åˆ°2010å¹´å†¬å­£çš„æ•°æ®
hgt = f['hgt'].loc[f.time.dt.month.isin([12,1,2])].loc  ['2005-12-01':'2011-02-01']
print(hgt)
#é€‰å–å¤å­£æ•°æ®
hgt_JJA= f['hgt'].loc[f.time.dt.season=='DJF']
print(hgt_JJA)
#å åŠ æ—¶é—´å’ŒèŒƒå›´çš„é€‰å–
#a = tmax.loc[:,40:55,115:135].loc[tmax.time.dt.season=='JJA']
</code></pre>
<p>å½“æ ¼å¼ä¸ºobject</p>
<pre><code>import xarray as xr
f = xr.open_dataset('/data/home/zenggang/yxy/CMIP6/SSP245/CanESM5/tas/t2m.nc')    
f= f.assign_coords(time = f.indexes['time'].to_datetimeindex())
tas = f['tas'].loc[f.time.dt.month.isin([12,1,2])].loc      ['2015-12-01':'2100-02-28']
</code></pre>
<p>æœ‰çš„æ¨¡å¼çš„æ—¶é—´æ˜¯0æ—¶(æ¯”å¦‚è¯´ 1979-01-01 00:00:00)ï¼Œè€Œæœ‰çš„æ¨¡å¼çš„æ—¶é—´æ˜¯12æ—¶(æ¯”å¦‚è¯´ 1979-01-01 12:00:00)ï¼Œå¦‚æœéœ€è¦ç»Ÿä¸€çš„è¯ï¼Œåªéœ€è¦æ­é…datetimeåº“è¿›è¡Œè°ƒæ•´å³å¯ï¼Œæ¯”å¦‚è¯´å°†æ‰€æœ‰çš„12æ—¶å˜ä¸º0æ—¶ï¼š</p>
<pre><code>from datetime import datetime, timedelta
f = f.assign_coords(time = (f.indexes['time'].to_datetimeindex()- timedelta(hours=12)))
</code></pre>
<p>#åœ¨å¾—åˆ°äº†ä¸€ä¸ªDataArrayä¹‹åï¼Œç”¨äºç”»å›¾æ—¶ï¼Œéœ€è¦è·å–ä»–çš„ç»åº¦ã€çº¬åº¦ã€é«˜åº¦ç­‰</p>
<pre><code>f.coords['time']
f['time']
print(f['time'])
</code></pre>
<p><font color=Blue><center><strong>ç´¢å¼•æ•°æ®</strong></font></center><br>
Xarrayå®˜æ–¹æä¾›äº†ä¸‰ç§æ–¹æ³•ç”¨æ¥ç´¢å¼•æ•°æ®ï¼š<br>
1.åˆ©ç”¨ä¸‹æ ‡ç´¢å¼•(index)<br>
2.åˆ©ç”¨åæ ‡å€¼ç´¢å¼•(coords)<br>
3.åˆ©ç”¨æ ‡ç­¾ç´¢å¼•(labels)<br>
<img src="https://RanX79.github.io//post-images/1661915454377.webp" alt="" loading="lazy"><br>
daæŒ‡DataArray;dsæŒ‡Dataset</p>
<pre><code>#method 1
print(hgt[:2])
#method 2
print(hgt[:, [2, 1]])
#method 3
print(f['hgt'].loc['2000-01':'2003-01'].lat[45:90])
h=f['hgt'] .loc['time1':'time2',lat1:lat2,lon1:lon2]
print(h)
#ç´¢å¼•å‡ºæ¥çš„æ•°æ®ç›´æ¥å¯ä»¥ä¿®æ”¹æˆ–è€…è®¡ç®—
</code></pre>
<p>#æ•°æ®ç¼ºæµ‹å¤„ç†<br>
print(hgt.where(hgt.lat &lt; 60))<br>
é¦–å…ˆå»ºç«‹ä¸€ä¸ªå¸¦æœ‰ç¼ºæµ‹çš„dataarray<br>
x = xr.DataArray([0, 1, np.nan, np.nan, 2], dims=['x'])<br>
print(x)<br>
åˆ¤æ–­æ˜¯å¦ç¼ºæµ‹,è¿˜æœ‰notnull()å‡½æ•°<br>
print(x.isnull())<br>
åˆ¤æ–­æœ‰å‡ ä¸ªæœªç¼ºæµ‹<br>
print(x.count())<br>
å»é™¤ç¼ºæµ‹<br>
print(x.dropna(dim='x'))<br>
å°†ç¼ºæµ‹å¡«ä¸º-1<br>
print(x.fillna(-1))</p>
<p><font color=Blue><center><strong>æ’å€¼</strong></font></center><br>
.interp()å‡½æ•°<br>
<a href="https://www.jianshu.com/p/e884d177ee62">æ’å€¼</a></p>
<p>æ¯”å¦‚è¯´æ°”è±¡ä¸Šéœ€è¦æ±‚é€å‘¨ï¼Œé€æ—¬ï¼Œé€å€™çš„æ•°æ®ï¼Œå¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å…ˆå°†å…¶èšå—ï¼Œå†è¿›è¡Œå¹³å‡ã€‚<br>
print(da.coarsen(time=7).mean())<br>
coarsen(time=7)å°†æ—¶é—´è½´æ¯7å¤©å›ºå®šåœ¨ä¸€èµ·ï¼Œé€šè¿‡å¹³å‡å‡½æ•°ï¼Œå¾—åˆ°äº†é€å‘¨çš„å¹³å‡ç»“æœã€‚<br>
ä½†æ˜¯è¿™é‡Œ364æ˜¯å¯ä»¥æ•´é™¤7çš„ï¼Œå¦‚æœä¸èƒ½åˆšå¥½æ•´é™¤çš„è¯ï¼Œè¿˜æä¾›äº†ä¸€äº›å‚æ•°æ¥å¤„ç†è¾¹ç•Œç»“æœã€‚<br>
boundary='trim'ï¼Œæˆ–è€…boundary='pad'.<br>
trimæ˜¯æŒ‡æœ«å°¾å¤šä½™çš„ä¸å‚ä¸è®¡ç®—ï¼Œæˆ–è€…å«ä¿®å»ºå¤šä½™æ¡ç›®ã€‚<br>
padæŒ‡å¡«å……nanåˆ°ä¸è¶³çš„åœ°æ–¹ï¼Œè¡¥å…¨ä¸ºå¯ä»¥æ•´é™¤çš„æ›´å¤§æ•°æ®å†è¿›è¡Œèšå—ã€‚</p>
<p>è¿˜å¯ä»¥é€šè¿‡coord_funcå‡½æ•°è¿”å›ä¸åŒçš„åæ ‡ä¿¡æ¯ã€‚<br>
æ¯”å¦‚è¯´é»˜è®¤ä¸‹ï¼Œ7å¤©å¹³å‡ï¼Œç»“æœçš„æ—¶é—´æ˜¯ç¬¬4å¤©ï¼Œå°±æ˜¯ä¸­é—´é‚£å¤©ï¼Œä½†æ˜¯é€šè¿‡coord_func={'time': 'min'}å¯ä»¥æŒ‡å®šæ—¶é—´ä¸ºæœ€å°çš„é‚£å¤©ã€‚</p>
<hr>
<p><font color=Blue><center><strong>æ•°æ®æ•´åˆï¼ˆåˆ†ç»„ï¼Œåˆå¹¶ï¼‰</strong></font></center><br>
splitÂ·å°†æ•°æ®åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„ç»„ã€‚<br>
applyÂ·å¯¹å„ä¸ªç»„è¿›è¡Œæ“ä½œã€‚<br>
combineÂ·å°†å„ä¸ªç»„åˆå¹¶ä¸ºä¸€ä¸ªæ•°æ®å¯¹è±¡ã€‚</p>
<hr>
<p><font color=Blue><center><strong>è¯»å–åŠç”Ÿæˆncæ–‡ä»¶</strong></font></center><br>
è¯»å–ncæ–‡ä»¶</p>
<pre><code>ds = xr.open_dataset('ds.nc')
xr.open_mfdataset('my/files/*.nc', parallel=True)
</code></pre>
<p>ç”Ÿæˆncæ–‡ä»¶</p>
<pre><code>ds = xr.Dataset({'prec': (('xy', 'time'), np.random.rand(4, 5))},coords={'lat': ('xy', [15, 25, 35, 45]),'lon': ('xy', [15, 25, 35, 45]),'time': pd.date_range('2000-01-01', periods=5),})
print(ds)
ds.to_netcdf('output.nc')
</code></pre>
<hr>
<p><font color=Blue><center><strong>è¯»å–txtæ–‡ä»¶</strong></font></center></p>
<pre><code>data = pd.read_csv(&quot;cslist.txt&quot;,sep=',',header=None, names=['a','b','c','d','e','f','g','h','i','j','k']) 
</code></pre>
<p>è¯»å–txtçš„åŒæ—¶ï¼Œå¯¹æ¯åˆ—èµ‹äºˆäº†ä¸€ä¸ªåˆ—åï¼Œé€šè¿‡data.aå¯ä»¥ç›´æ¥æŒ‰åˆ—åè°ƒç”¨ç›¸åº”æ•°æ®ã€‚<br>
å¯¹äºè¾ƒå¤æ‚çš„.txtæ–‡ä»¶ï¼Œä»å¯é€šè¿‡è¯¥å‡½æ•°è¯»å–</p>
<hr>
<p><font color=Blue><center><strong>è¯»å–gribæ–‡ä»¶</strong></font></center><br>
gribæ–‡ä»¶å¯é€šè¿‡pygribåº“è¯»å–<br>
import pygrib<br>
f = pygrib.open('xxx.grb')</p>
<p><font style=background:red size=4><center>å¸¸ç”¨æ•°æ®è®¡ç®—æ–¹æ³•</font></center><br>
<font color=Blue><strong>å¸¸ç”¨çš„ç»Ÿè®¡æ–¹æ³•</strong></font></p>
<p><em><strong>import numpy as np</strong></em></p>
<p><font color=pink><strong>å¹³å‡å€¼</strong></font><br>
åœ¨è®¡ç®—æ°”å€™æ€ï¼ŒåŒºåŸŸå¹³å‡æ—¶å‡è¦ä½¿ç”¨åˆ°æ±‚å‡å€¼å‡½æ•°ï¼Œå¯¹åº”NCLä¸­çš„dim_averageå‡½æ•°ï¼Œåœ¨pythonä¸­é€šå¸¸ä½¿ç”¨** np.mean()**å‡½æ•°</p>
<center>numpy.mean(a, axis, dtype)</center>
å‡è®¾aä¸º[time,lat,lon]çš„æ•°æ®ï¼Œé‚£ä¹ˆ
Â·axis ä¸è®¾ç½®å€¼ï¼Œå¯¹ timelatlon ä¸ªå€¼æ±‚å‡å€¼ï¼Œè¿”å›ä¸€ä¸ªæ•°
Â·axis = 0ï¼šå‹ç¼©æ—¶é—´ç»´ï¼Œå¯¹æ¯ä¸€ä¸ªç»çº¬ç‚¹æ±‚å‡å€¼ï¼Œè¿”å› [lat, lon] æ•°ç»„(å¦‚æ±‚ä¸€ä¸ªåœºçš„Nå¹´æ°”å€™æ€)
Â·axis =1,2 ï¼šå‹ç»åº¦çº¬åº¦ï¼Œå¯¹æ¯ä¸ªæ—¶é—´æ±‚å¹³å‡å€¼ï¼Œè¿”å› [time] çŸ©é˜µ(å¦‚æ±‚æŸæ—¶é—´åºåˆ—ï¼Œæˆ–æŒ‡æ•°)
<p>ğŸ’¦æ°”è±¡æ•°æ®ä¸­å¸¸æœ‰ç¼ºæµ‹ï¼Œåœ¨NCLä¸­ï¼Œä½¿ç”¨æ±‚å‡å€¼å‡½æ•°ä¼šè‡ªåŠ¨ç•¥è¿‡ï¼Œè€Œåœ¨pythonä¸­ï¼Œå½“ä»»æ„ä¸€æ•°ä¸ç¼ºæµ‹(np.nan)è®¡ç®—çš„ç»“æœå‡ä¸ºnp.nanï¼Œæ¯”å¦‚æ±‚[1,2,3,4ï¼Œnp.nan]çš„å¹³å‡å€¼ï¼Œç»“æœä¸ºnp.nan<br>
å› æ­¤ï¼Œå½“æ•°æ®å­˜åœ¨ç¼ºæµ‹æ•°æ®æ—¶ï¼Œé€šå¸¸ä½¿ç”¨**np.nanmean()<strong>å‡½æ•°ï¼Œç”¨æ³•åŒä¸Šï¼Œæ­¤æ—¶[1,2,3,4ï¼Œnp.nan]çš„å¹³å‡å€¼ä¸º(1+2+3+4)/4 = 2.5<br>
åŒæ ·çš„ï¼Œæ±‚æŸæ•°ç»„æœ€å¤§æœ€å°å€¼æ—¶ä¹Ÿæœ‰</strong>np.nanmax(), np.nanmin()**å‡½æ•°æ¥è¡¥å……np.max(), np.min()çš„ä¸è¶³ã€‚<br>
å…¶ä»–å¾ˆå¤šnpçš„è®¡ç®—å‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‰è¾¹åŠ â€˜nanâ€™æ¥ä½¿ç”¨ã€‚</p>
<p><font color=pink><strong>æ ‡å‡†å·®</strong></font></p>
<center>np.std(a, axis, dtype)</center>
ç”¨æ³•åŒnp.mean()
<p><font color=pink><strong>æ ‡å‡†åŒ–</strong></font></p>
<center>np.std(a, axis, dtype)</center>
åœ¨NCLä¸­æœ‰ç›´æ¥æ±‚æ•°æ®æ ‡å‡†åŒ–çš„å‡½æ•°dim_standardize()ï¼Œ
<pre><code>x = (x - np.mean(x)) / np.std(x)
</code></pre>
<p><font color=pink><strong>ç›¸å…³ç³»æ•°</strong></font><br>
çš®å°”é€Šç›¸å…³ç³»æ•°ï¼š<br>
numpyå‡½æ•°ä¸­çš„np.corrcoef(x, y)ï¼Œå¯ä»¥å®ç°ç›¸å…³è®¡ç®—<br>
scipy.statsä¸­çš„å‡½æ•°<br>
from scipy.stats import pearsonr<br>
r,p = pearsonr(x, y)<br>
ä¼˜ç‚¹æ˜¯å¯ä»¥ç›´æ¥è¿”å›ç›¸å…³ç³»æ•°RåŠå…¶På€¼ï¼Œè¿™é¿å…äº†æˆ‘ä»¬è¿›ä¸€æ­¥è®¡ç®—ç½®ä¿¡åº¦ã€‚è€Œç¼ºç‚¹åˆ™æ˜¯è¯¥å‡½æ•°åªæ”¯æŒä¸¤ä¸ªä¸€ç»´æ•°ç»„çš„è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸ªåœºå’Œä¸€ä¸ªåºåˆ—çš„ç›¸å…³æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¾ªç¯æ¥å®ç°ã€‚</p>
<pre><code>r = np.zeros((a.shape[1],a.shape[2]))
p = np.zeros((a.shape[1],a.shape[2]))
for i in range(sic.shape[1]):
    for j in range(sic.shape[2]):
         r[i,j], p[i,j] = pearsonr(b , a[:,i,j])
</code></pre>
<p>å…¶ä¸­a[time,lat,lon]ï¼Œb[time]</p>
<p><font color=pink><strong>çº¿æ€§å›å½’ç³»æ•°</strong></font><br>
(NCLä¸­ä¸ºregcoef()å‡½æ•°)<br>
åŒæ ·æ¨èScipyåº“ä¸­çš„stats.linregress(x,y)å‡½æ•°ï¼š<br>
slope, intercept, r_value, p_value, std_err = stats.linregress(x,y)</p>
<p>slop: å›å½’æ–œç‡<br>
interceptï¼šå›å½’æˆªè·<br>
r_valueï¼š ç›¸å…³ç³»æ•°<br>
p_valueï¼š På€¼<br>
std_errï¼š ä¼°è®¡æ ‡å‡†è¯¯å·®<br>
ç›´æ¥å¯ä»¥è¾“å‡ºPå€¼ï¼ŒåŒæ ·çœå»äº†åšç½®ä¿¡åº¦æ£€éªŒçš„è¿‡ç¨‹ï¼Œé—æ†¾çš„æ˜¯ä»éœ€åŒç›¸å…³ç³»æ•°ä¸€æ ·å¾ªç¯è®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://RanX79.github.io//post-images/1661927378085.jpg" alt="" loading="lazy"></figure>
<p>ğŸ’«æ¥æºï¼š<a href="https://www.jianshu.com/u/9293eb1f7254">ç®€ä¹¦-æ‘¸é±¼å’¯</a>å¤§ä½¬ï¼ï¼ï¼ï¼âœï¸</p>

              </div>
              <div class="toc-container">
                
              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://RanX79.github.io/post/da-qi-zhuang-tai-yi-chang/">
              <h3 class="post-title">
                å¤§æ°”çŠ¶æ€å¼‚å¸¸
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '56be7867f051d340452d',
    clientSecret: '7dabf01519680ef7221f9138b1797c4af21676d9',
    repo: 'RanX79.github.io',
    owner: 'RanX79',
    admin: ['RanX79'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  ä»Šå¤©ä¹Ÿè¦å¥½å¥½å­¦ä¹ å“¦ï¼
  <a class="rss" href="https://RanX79.github.io//atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
